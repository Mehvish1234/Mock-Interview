{% extends "layout.html" %}

{% block title %}Interview Progress Dashboard{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
{% if not_logged_in %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h2 class="mb-4">Welcome to Interview Progress Tracker</h2>
                    <p class="lead mb-4">Track your interview journey and monitor your progress in real-time.</p>
                    <div class="d-grid gap-3 d-md-flex justify-content-md-center">
                        <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg me-md-2">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </a>
                        <a href="{{ url_for('register') }}" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-user-plus me-2"></i>Register
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Top Header with Profile -->
<div class="dashboard-header">
    <div class="container-fluid">
        <div class="header-content">
            <div class="header-left">
                <h1 class="dashboard-main-title">
                    <i class="fas fa-chart-line me-2"></i>Learning Dashboard
                </h1>
                <p class="dashboard-main-subtitle">Track your progress across all features</p>
            </div>
            <div class="header-right">
                <div class="profile-dropdown">
                    <button class="profile-btn" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{{ url_for('static', filename='profile_photos/' + (user.profile_photo or 'default-profile.png')) }}" 
                             alt="Profile" class="profile-avatar">
                        <span class="profile-name">{{ user.name }}</span>
                        <i class="fas fa-chevron-down ms-2"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end profile-dropdown-menu" aria-labelledby="profileDropdown">
                        <li class="dropdown-header">
                            <div class="user-info">
                                <img src="{{ url_for('static', filename='profile_photos/' + (user.profile_photo or 'default-profile.png')) }}" 
                                     alt="Profile" class="dropdown-avatar">
                                <div>
                                    <div class="user-name">{{ user.name }}</div>
                                    <div class="user-email">{{ user.email }}</div>
                                </div>
                            </div>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#profilePhotoModal">
                                <i class="fas fa-camera me-2"></i>Change Photo
                            </button>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('interview_progress') }}">
                                <i class="fas fa-user-edit me-2"></i>Edit Profile
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Profile Photo Upload -->
<div class="modal fade" id="profilePhotoModal" tabindex="-1" aria-labelledby="profilePhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="profilePhotoModalLabel">Update Profile Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/upload_profile_photo" method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="profile_photo" class="form-label">Choose a photo (PNG, JPG, JPEG, GIF)</label>
                        <input type="file" class="form-control" id="profile_photo" name="profile_photo" accept="image/*" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Upload Photo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Full Width Dashboard -->
<div class="dashboard-container">
    <!-- Overall Progress Chart Section -->
    <div class="overall-progress-section">
        <div class="container-fluid">
            <div class="progress-chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-area me-2"></i>Overall Progress Overview
                    </h3>
                    <div class="chart-controls">
                        <select class="form-select form-select-sm" id="progressTimeRange">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 3 months</option>
                        </select>
                    </div>
                </div>
                <div class="progress-chart-grid">
                    <!-- Overall Score Gauge -->
                    <div class="score-gauge-container">
                        <div class="gauge-chart" id="overallScoreGauge">
                            <div class="gauge-center">
                                <div class="gauge-value">{{ ((stats.avg_performance or 7.5) * 10)|round(1) }}%</div>
                                <div class="gauge-label">Overall Score</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Trend Chart -->
                    <div class="trend-chart-container">
                        <canvas id="progressTrendChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- Key Metrics -->
                    <div class="key-metrics">
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-fire text-danger"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-value">{{ ((stats.ai_interviews or 0) + (stats.avatar_interviews or 0)) }}</div>
                                <div class="metric-label">Total Sessions</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-trophy text-warning"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-value">{{ stats.dsa_solved or 0 }}</div>
                                <div class="metric-label">Problems Solved</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon">
                                <i class="fas fa-trending-up text-success"></i>
                            </div>
                            <div class="metric-details">
                                <div class="metric-value">+{{ stats.improvement or 1.2 }}</div>
                                <div class="metric-label">Monthly Growth</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Dashboard Content -->
    <div class="main-dashboard-content">
        <div class="container-fluid">
            <div class="dashboard-stats">
                <!-- Header -->
                <div class="stats-header">
                    <div class="header-content">
                        <h3 class="dashboard-title">
                            <i class="fas fa-chart-pie me-2"></i>Learning Dashboard
                        </h3>
                        <p class="dashboard-subtitle">Track your progress across all features</p>
                    </div>
                    <div class="date-filter">
                        <select class="form-select form-select-sm" id="dateRange">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 3 months</option>
                        </select>
                    </div>
                </div>
                
                <!-- Feature Overview Cards -->
                <div class="feature-cards-grid">
                    <div class="feature-card ai-interview" data-tooltip="AI-powered interview practice sessions">
                        <div class="card-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="card-content">
                            <div class="metric-value">{{ stats.ai_interviews or 0 }}</div>
                            <div class="metric-label">AI Interviews</div>
                            <div class="completion-rate">
                                <div class="rate-bar">
                                    <div class="rate-fill" style="width: {{ (stats.ai_completion_rate or 75) }}%"></div>
                                </div>
                                <span class="rate-text">{{ (stats.ai_completion_rate or 75) }}% completion</span>
                            </div>
                        </div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+12%</span>
                        </div>
                    </div>
                    
                    <div class="feature-card avatar-interview" data-tooltip="Video-based avatar interview practice">
                        <div class="card-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="card-content">
                            <div class="metric-value">{{ stats.avatar_interviews or 0 }}</div>
                            <div class="metric-label">Avatar Interviews</div>
                            <div class="completion-rate">
                                <div class="rate-bar">
                                    <div class="rate-fill" style="width: {{ (stats.avatar_completion_rate or 60) }}%"></div>
                                </div>
                                <span class="rate-text">{{ (stats.avatar_completion_rate or 60) }}% completion</span>
                            </div>
                        </div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8%</span>
                        </div>
                    </div>
                    
                    <div class="feature-card company-prep" data-tooltip="Company-specific interview preparation">
                        <div class="card-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="card-content">
                            <div class="metric-value">{{ stats.company_sessions or 0 }}</div>
                            <div class="metric-label">Company Prep</div>
                            <div class="completion-rate">
                                <div class="rate-bar">
                                    <div class="rate-fill" style="width: {{ (stats.company_progress or 80) }}%"></div>
                                </div>
                                <span class="rate-text">{{ (stats.company_progress or 80) }}% progress</span>
                            </div>
                        </div>
                        <div class="card-trend neutral">
                            <i class="fas fa-minus"></i>
                            <span>0%</span>
                        </div>
                    </div>
                    
                    <div class="feature-card dsa-practice" data-tooltip="Data Structures & Algorithms practice">
                        <div class="card-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <div class="card-content">
                            <div class="metric-value">{{ stats.dsa_solved or 0 }}/{{ stats.dsa_total or 100 }}</div>
                            <div class="metric-label">DSA Problems</div>
                            <div class="completion-rate">
                                <div class="rate-bar">
                                    <div class="rate-fill" style="width: {{ ((stats.dsa_solved or 0) / (stats.dsa_total or 100) * 100) }}%"></div>
                                </div>
                                <span class="rate-text">{{ ((stats.dsa_solved or 0) / (stats.dsa_total or 100) * 100)|round(1) }}% solved</span>
                            </div>
                        </div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+15%</span>
                        </div>
                    </div>
                    
                    <div class="feature-card english-booster" data-tooltip="English communication improvement">
                        <div class="card-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div class="card-content">
                            <div class="metric-value">{{ stats.english_sessions or 0 }}</div>
                            <div class="metric-label">English Booster</div>
                            <div class="completion-rate">
                                <div class="rate-bar">
                                    <div class="rate-fill" style="width: {{ (stats.english_improvement or 70) }}%"></div>
                                </div>
                                <span class="rate-text">{{ (stats.english_improvement or 70) }}% improvement</span>
                            </div>
                        </div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+22%</span>
                        </div>
                    </div>
                    
                    <div class="feature-card resume-status" data-tooltip="Resume upload and optimization status">
                        <div class="card-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="card-content">
                            <div class="metric-value">{{ stats.resume_status or 'Not Uploaded' }}</div>
                            <div class="metric-label">Resume Status</div>
                            <div class="completion-rate">
                                <div class="rate-bar">
                                    <div class="rate-fill" style="width: {{ (stats.resume_completion or 0) }}%"></div>
                                </div>
                                <span class="rate-text">
                                    {% if stats.resume_status == 'Uploaded' %}Ready{% else %}Needs Update{% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="card-trend neutral">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Action needed</span>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Analytics -->
                <div class="performance-analytics">
                    <div class="analytics-header">
                        <h4 class="section-title">
                            <i class="fas fa-chart-line me-2"></i>Performance Analytics
                        </h4>
                    </div>
                    
                    <div class="analytics-content">
                        <!-- Circular Progress Chart -->
                        <div class="circular-progress-section">
                            <div class="circular-progress" data-percentage="{{ (stats.avg_performance or 7.5) * 10 }}">
                                <div class="progress-circle">
                                    <div class="progress-value">
                                        <span class="score">{{ stats.avg_performance or 7.5 }}</span>
                                        <span class="max">/10</span>
                                    </div>
                                </div>
                            </div>
                            <div class="progress-label">Average Interview Score</div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div class="performance-metrics">
                            <div class="metric-item">
                                <div class="metric-icon best">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="metric-details">
                                    <div class="metric-value">{{ stats.best_score or 9.2 }}</div>
                                    <div class="metric-label">Best Score</div>
                                </div>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-icon average">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="metric-details">
                                    <div class="metric-value">{{ stats.avg_performance or 7.5 }}</div>
                                    <div class="metric-label">Average</div>
                                </div>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-icon improvement">
                                    <i class="fas fa-arrow-trend-up"></i>
                                </div>
                                <div class="metric-details">
                                    <div class="metric-value">+{{ stats.improvement or 1.2 }}</div>
                                    <div class="metric-label">This Month</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Timeline -->
                <div class="activity-timeline">
                    <div class="timeline-header">
                        <h4 class="section-title">
                            <i class="fas fa-clock me-2"></i>Recent Activity
                        </h4>
                        <a href="{{ url_for('interview_progress') }}" class="view-all-link">
                            <i class="fas fa-calendar me-1"></i>View All Interviews
                        </a>
                    </div>
                    
                    <div class="timeline-content">
                        <div class="timeline-item completed">
                            <div class="timeline-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="timeline-details">
                                <div class="activity-title">AI Interview Completed</div>
                                <div class="activity-meta">Software Engineer • Score: 8.5/10</div>
                                <div class="activity-time">2 hours ago</div>
                            </div>
                            <div class="activity-badge completed">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                        
                        <div class="timeline-item upcoming">
                            <div class="timeline-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="timeline-details">
                                <div class="activity-title">Google Interview Prep</div>
                                <div class="activity-meta">System Design • Scheduled</div>
                                <div class="activity-time">Tomorrow 2:00 PM</div>
                            </div>
                            <div class="activity-badge scheduled">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        
                        <div class="timeline-item completed">
                            <div class="timeline-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="timeline-details">
                                <div class="activity-title">DSA Practice Session</div>
                                <div class="activity-meta">5 problems solved • Binary Trees</div>
                                <div class="activity-time">Yesterday</div>
                            </div>
                            <div class="activity-badge completed">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            
            <!-- Recent Interviews Section -->
            <div class="recent-interviews-section">
                <div class="card shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0"><i class="fas fa-history me-2"></i>Recent Interviews</h3>
                        <a href="{{ url_for('interview_progress') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Add Interview
                        </a>
                    </div>
                    <div class="card-body">
                        {% if interviews %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-building me-2"></i>Company</th>
                                        <th><i class="fas fa-briefcase me-2"></i>Position</th>
                                        <th><i class="fas fa-calendar me-2"></i>Date</th>
                                        <th><i class="fas fa-info-circle me-2"></i>Status</th>
                                        <th><i class="fas fa-cog me-2"></i>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for interview in interviews[:5] %}
                                        <tr>
                                            <td>{{ interview.company }}</td>
                                            <td>{{ interview.position }}</td>
                                            <td>{{ interview.date.strftime('%Y-%m-%d') }}</td>
                                            <td>
                                                <span class="badge rounded-pill
                                                    {% if interview.status == 'Upcoming' %}bg-info
                                                    {% elif interview.status == 'Completed' %}bg-success
                                                    {% elif interview.status == 'Rejected' %}bg-danger
                                                    {% elif interview.status == 'Offered' %}bg-warning
                                                    {% endif %}">
                                                    <i class="fas 
                                                        {% if interview.status == 'Upcoming' %}fa-clock
                                                        {% elif interview.status == 'Completed' %}fa-check
                                                        {% elif interview.status == 'Rejected' %}fa-times
                                                        {% elif interview.status == 'Offered' %}fa-trophy
                                                        {% endif %} me-1"></i>
                                                    {{ interview.status }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="btn-group">
                                                    <a href="{{ url_for('edit_interview', id=interview.id) }}" 
                                                       class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <form action="{{ url_for('delete_interview', id=interview.id) }}" 
                                                          method="POST" class="d-inline">
                                                        <button type="submit" class="btn btn-sm btn-outline-danger" 
                                                                onclick="return confirm('Are you sure you want to delete this interview?')">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <a href="{{ url_for('interview_progress') }}" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>View All Interviews
                            </a>
                        </div>
                        {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
                            <h4>No interviews yet</h4>
                            <p class="text-muted">Start tracking your interview progress by adding your first interview.</p>
                            <a href="{{ url_for('interview_progress') }}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Add Interview
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="https://kit.fontawesome.com/4f23053fa0.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Overall Progress Chart
    initializeProgressTrendChart();
    
    // Animate gauge chart
    animateGaugeChart();
    
    // Animate circular progress (legacy)
    const circularProgress = document.querySelector('.circular-progress');
    if (circularProgress) {
        const percentage = circularProgress.dataset.percentage || 75;
        const progressCircle = circularProgress.querySelector('.progress-circle');
        
        setTimeout(() => {
            progressCircle.style.background = `conic-gradient(from 0deg, #4f46e5 0%, #4f46e5 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }, 500);
    }

    // Initialize Progress Trend Chart
    function initializeProgressTrendChart() {
        const ctx = document.getElementById('progressTrendChart');
        if (!ctx) return;

        // Sample data - in real app, this would come from backend
        const chartData = {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [
                {
                    label: 'AI Interviews',
                    data: [6.5, 7.2, 7.8, {{ stats.avg_performance or 7.5 }}],
                    borderColor: '#4f46e5',
                    backgroundColor: 'rgba(79, 70, 229, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'DSA Progress',
                    data: [40, 55, 68, {{ ((stats.dsa_solved or 0) / (stats.dsa_total or 100) * 100)|round(1) }}],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'English Score',
                    data: [70, 75, 82, {{ stats.english_improvement or 70 }}],
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        };

        new Chart(ctx, {
            type: 'line',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Progress Trend Over Time',
                        font: {
                            size: 14,
                            weight: '600'
                        },
                        color: '#374151'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            font: {
                                size: 11
                            },
                            color: '#6b7280'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                size: 11
                            },
                            color: '#6b7280'
                        }
                    }
                },
                elements: {
                    point: {
                        radius: 4,
                        hoverRadius: 6
                    }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeInOutQuart'
                }
            }
        });
    }

    // Animate Gauge Chart
    function animateGaugeChart() {
        const gaugeChart = document.getElementById('overallScoreGauge');
        if (!gaugeChart) return;

        const percentage = {{ ((stats.avg_performance or 7.5) * 10)|round(1) }};
        
        setTimeout(() => {
            gaugeChart.style.background = `conic-gradient(
                from 0deg,
                #4f46e5 0%,
                #4f46e5 ${percentage}%,
                #e5e7eb ${percentage}%,
                #e5e7eb 100%
            )`;
        }, 1000);
    }
    
    // Animate progress bars
    const progressBars = document.querySelectorAll('.rate-fill');
    progressBars.forEach((bar, index) => {
        setTimeout(() => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 100);
        }, index * 200);
    });
    
    // Add click handlers for feature cards
    document.querySelectorAll('.feature-card').forEach(card => {
        card.addEventListener('click', function() {
            const cardType = this.classList[1]; // Get the second class (feature type)
            
            // Define navigation mapping
            const navigationMap = {
                'ai-interview': '/ai_interview',
                'avatar-interview': '/avatar_interview',
                'company-prep': '/company_prep',
                'dsa-practice': '/dsa',
                'english-booster': '/english_booster',
                'resume-status': '/resume_template'
            };
            
            const url = navigationMap[cardType];
            if (url) {
                window.location.href = url;
            }
        });
    });
    
    // Date range filter functionality
    const dateRangeSelect = document.getElementById('dateRange');
    if (dateRangeSelect) {
        dateRangeSelect.addEventListener('change', function() {
            const days = this.value;
            // In a real application, you would fetch new data here
            console.log(`Fetching data for last ${days} days`);
            
            // For demo purposes, we'll just show a loading state
            const cards = document.querySelectorAll('.feature-card');
            cards.forEach(card => {
                card.style.opacity = '0.6';
            });
            
            setTimeout(() => {
                cards.forEach(card => {
                    card.style.opacity = '1';
                });
            }, 1000);
        });
    }
    
    // Add hover effects for timeline items
    document.querySelectorAll('.timeline-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateX(10px)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0)';
        });
    });
    
    // Tooltip functionality
    document.querySelectorAll('[data-tooltip]').forEach(element => {
        element.addEventListener('mouseenter', function() {
            const tooltip = this.dataset.tooltip;
            console.log('Showing tooltip:', tooltip);
        });
    });
    
    // Counter animation for metric values
    function animateCounter(element, target) {
        const increment = target / 50;
        let current = 0;
        
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            element.textContent = Math.floor(current);
        }, 20);
    }
    
    // Animate counters when page loads
    document.querySelectorAll('.metric-value').forEach(element => {
        const text = element.textContent;
        const number = parseInt(text.replace(/[^0-9]/g, ''));
        if (number && !isNaN(number)) {
            element.textContent = '0';
            setTimeout(() => {
                animateCounter(element, number);
            }, 1000);
        }
    });
});

// Function to update dashboard stats (can be called from other parts of the app)
function updateDashboardStats(newStats) {
    // Update feature cards
    Object.keys(newStats).forEach(key => {
        const element = document.querySelector(`[data-stat="${key}"]`);
        if (element) {
            element.textContent = newStats[key];
        }
    });
    
    // Update circular progress
    const circularProgress = document.querySelector('.circular-progress');
    if (circularProgress && newStats.avg_performance) {
        const percentage = newStats.avg_performance * 10;
        circularProgress.dataset.percentage = percentage;
        
        const progressCircle = circularProgress.querySelector('.progress-circle');
        progressCircle.style.background = `conic-gradient(from 0deg, #4f46e5 0%, #4f46e5 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        
        const scoreElement = circularProgress.querySelector('.score');
        if (scoreElement) {
            scoreElement.textContent = newStats.avg_performance;
        }
    }
}
</script>
{% endblock %}
